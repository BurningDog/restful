<?php

/**
 * @file
 * Turn Drupal to a RESTful server, following best practices.
 */

/**
 * Implements hook_ctools_plugin_directory().
 */
function restful_ctools_plugin_directory($module, $plugin) {
  if ($module == 'restful') {
    return 'plugins/' . $plugin;
  }
}

/**
 * Add defaults values to the notifier plugins.
 *
 * - 'description': The description of the plugin.
 * - 'options': Array with the following keys:
 *   - 'save on fail': Save the message is delivery failed. Defaults to
 *     TRUE.
 *   - 'save on success': Save the message is delivery successded. Defaults to
 *     TRUE.
 *   - 'language override': Override user's language, and use the
 *     Message's language. Defaults to FALSE.
 *   - 'rendered fields': Array keyed with the view mode(s), and the text
 *     field(s) to save the rendered output.
 *     The rendered field is used when it is needed to save the message
 *     exactly as it was sent (for example for message logs), as it might
 *     change and show differently when viewed later - as a result of on
 *     the fly token replacement, or even editing the message type.
 */
function restful_plugin_process(&$plugin, $info) {
  $plugin += array(
    'description' => '',
    'options' => array(),
  );

  $plugin['options'] += array(
  );
}

/**
 * Implements hook_ctools_plugin_type().
 */
function restful_ctools_plugin_type() {
  $plugins['notifier'] = array(
    'classes' => array('class'),
    'process' => 'restful_plugin_process',
  );
  return $plugins;
}


/**
 * Helper function to include CTools plugins and get a restful plguin.
 *
 * @param $plugin_name
 *   The plugin that should be loaded.
 */
function restful_get_notifier($plugin_name) {
  ctools_include('plugins');
  return ctools_get_plugins('restful', 'restful', $plugin_name);
}

/**
 * Helper function to include CTools plugins and get all restful plugins.
 */
function restful_get_notifiers() {
  ctools_include('plugins');
  return ctools_get_plugins('restful', 'restful');
}
